<link href="/resources/css/dragula.min.css" rel="stylesheet" type="text/css">
<link href="/resources/css/seating.css" rel="stylesheet" type="text/css">
<link href="/resources/css/seating_single_room.css" rel="stylesheet" type="text/css">
<div class="page-content">
	{% if not msg == None %}
	<div>
		{{msg}}
	</div>
	{% endif %}

	{% if classrooms|length > 0 %}
		<form method="get" action="/seating">
			<label>Select a Class
				<select name="classroom">
					<option value=""></option>
					{% for classroom_select in classrooms %}
						<option value="{{ classroom_select.key.urlsafe() }}">
							{{ classroom_select.name }}
						</option>
					{% endfor %}
				</select>
			</label>
			<button>Go!</button>
	  </form>
	{% else %}
		<div>You must create a classroom before you can set up seating!</div>
	{% endif %}

	{% if classroom %}
		<h1>Generate Seating</h1>

		<section class="seating-main">
			<div class="classroom-options">
				<h2 class="classroom-name">
					{{ classroom.name }}
					{% if day and is_saved %}
						: Day {{ day }}
					{% endif %}
				</h2>
				<a href="/classroom?id={{ classroom.key.urlsafe() }}"
					 class="mdl-button mdl-js-button mdl-button--accent">
					 Manage Class
				 </a>

				{% if students|length == 30 %}
					<a href="/seating?classroom={{ classroom.key.urlsafe() }}&list=true"
					   class="mdl-button mdl-js-button mdl-button--accent">
						View all saved seating arrangements
					</a>
				{% endif %}
			</div>

			<div class="seating">
				{% if students|length == 30 %}
					<div>
						<section id="room" class="clearfix">
							{% for i in range(0, students|length, 6) %}
							<div class="table clearfix container" name="{{ i / 6 }}">
								{% for j in range(6) %}
									<div class="student" id="{{ students[i + j].key.urlsafe() }}">
										{{ students[i + j].name }}
									</div>
								{% endfor %}
							</div>
							{% endfor %}
						</section>
					</div>

					<div class="seating-options">
						<form method="get" action="/seating">
							<input type="hidden" name="classroom" value="{{classroom.key.urlsafe()}}">
							<button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">
								Regenerate Seating
							</button>
						</form>

						{% if day and not is_saved %}
							<form method="post" action="/seating">
								<input type="hidden" name="classroom_id"
											 value="{{ classroom.key.urlsafe() }}">
								<input type="hidden" name="keystring">
								<input type="hidden" name="day" value="{{ day }}">
								<button id="save"
											  class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--primary">
										Save this Arrangement: Day {{ day }}
								</button>
							</form>
						{% endif %}
					</div>
				{% else %}
					<div class="error">
						Error: Class has fewer than 30 students. Please add students.
					</div>
				{% endif %}
			</div>
		</section>
	{% endif %}
	<script src='/resources/scripts/dragula.min.js'></script>
	<script src='/resources/scripts/seating.js'></script>
	<script>
		document.addEventListener('DOMContentLoaded', main, false);
	</script>
</div>

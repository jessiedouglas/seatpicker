<link href="/resources/css/dragula.min.css" rel="stylesheet" type="text/css">
<link href="/resources/css/seating.css" rel="stylesheet" type="text/css">
<link href="/resources/css/seating_single_room.css" rel="stylesheet" type="text/css">
<div class="page-content">
	{% if not msg == None %}
	<div>
		{{msg}}
	</div>
	{% endif %}

	{% if classrooms|length > 0 %}
		<form method="get" action="/seating">
			<div class="mdl-textfield mdl-js-textfield getmdl-select">
				<input type="text" value="" class="mdl-textfield__input" id="classroom" readonly>
				<input type="hidden" name="classroom" value="">
				<i class="mdl-icon-toggle__label material-icons">
					keyboard_arrow_down
				</i>
				<label for="classroom" class="mdl-textfield__label">
					Select a class...
				</label>
				<ul for="classroom" class="mdl-menu mdl-menu--bottom-left mdl-js-menu">
					{% for classroom_select in classrooms %}
						<li class="mdl-menu__item"
								data-val="{{ classroom_select.key.urlsafe() }}">
								{{ classroom_select.name }}
						</li>
					{% endfor %}
				</ul>
			</div>
			<button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
				Go!
			</button>
	  </form>
	{% else %}
		<div>You must create a classroom before you can set up seating!</div>
	{% endif %}

	{% if classroom and students|length > 0 %}
		<h1>Generate Seating</h1>

		<section class="seating-main">
			<div class="classroom-options">
				<h2 class="classroom-name">
					{{ classroom.name }}
					{% if day and is_saved %}
						: Day {{ day }}
					{% endif %}
				</h2>
				<a href="/classroom?id={{ classroom.key.urlsafe() }}"
					 class="mdl-button mdl-js-button mdl-button--accent">
					 Manage Class
				</a>

				<a href="/seating?classroom={{ classroom.key.urlsafe() }}&list=true"
				   class="mdl-button mdl-js-button mdl-button--accent">
					View all saved seating arrangements
				</a>
			</div>

		<div class="seating">
				<div>
					<section id="room" class="clearfix">
						{% for student in students %}
							<div class="student" id="{{ student.key.urlsafe() }}">
								{{ student.name }}
							</div>
						{% endfor %}
					</section>
				</div>

				<div class="seating-options">
					<form class="seating-layout">
						<label>Table Size:
							<select class="seating-layout-select">
								{% for i in range(2, students|length + 1, 2) %}
									<option value="{{i}}" selected="{{ i == 6 }}">{{i}}</option>
								{% endfor %}
							</select>
						</label>
					</form>

					<form method="get" action="/seating">
						<input type="hidden" name="classroom" value="{{classroom.key.urlsafe()}}">
						<button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">
							Regenerate Seating
						</button>
					</form>

					{% if day and not is_saved %}
						<form method="post" action="/seating">
							<input type="hidden" name="classroom_id"
										 value="{{ classroom.key.urlsafe() }}">
							<input type="hidden" name="keystring">
							<input type="hidden" name="day" value="{{ day }}">
							<button id="save"
										  class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--primary">
									Save this Arrangement: Day {{ day }}
							</button>
						</form>
					{% endif %}
				</div>
			{% else %}
				<div class="error">
					Error: Class has no students. Please add students.
				</div>
			{% endif %}
		</div>
	</section>
	<script src='/resources/scripts/dragula.min.js'></script>
	<script src='/resources/scripts/seating.js'></script>
	<script>
		document.addEventListener('DOMContentLoaded', main, false);
	</script>
</div>
